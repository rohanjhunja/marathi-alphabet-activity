<!DOCTYPE html>
<html>
<head>
<link href='https://fonts.googleapis.com/css?family=Mukta' rel='stylesheet'>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript">
</script>
<title>Card Activity</title>
</head>
<style type="text/css">
	body{
		font-family: 'Mukta';
		font-size: 10vw;
	}
	.screen{
		width: 100vw; height: 100vh; display: flex; align-items: center; flex-direction:column; justify-content: space-around;
	}

	.gameOption{
		height:30vh;
		width:auto;
	}
</style>
<body>

<div id="card" class="screen"><img id = "cardImage" style="width: 100vw; height: auto;"><a id ="playButton" onclick="loadGame()">play</a></div>
<div id="game" class="screen" style="display: none;"><div id="instruction"></div><img class="gameOption" id = "gameImage0" onclick = "checkAnswer(0)"><img class="gameOption" id = "gameImage1" onclick = "checkAnswer(1)"><img class="gameOption" id = "gameImage2" onclick = "checkAnswer(2)"></div>
<div id='answer' class='screen' style="display: none;"><img id='answerImage' class='gameOption'><div id="answerWord"></div><a id ="playButton" onclick="resetGame()">replay</a></div>

</body>
<script type="text/javascript">
var scoreSound = new sound("ring.mp3");
var buttonSound = new sound("pop.mp3");
const synth = window.speechSynthesis; 
  	var speakText;

var data1;
var someData;
var url="https://raw.githubusercontent.com/rohanjhunja/marathi-alphabet-activity/main/"+letters+".txt";

$.get(url).then(function(data){ 
    data1=data; 
    someData = JSON.parse(data1);
});

var all = Object.keys(someData).length;
let searchParams = new URLSearchParams(window.location.search);
var letter = searchParams.get("letter");

const result = someData.filter( ({ key }) => key === letter );
console.log(letter); 
console.log(result);

let options = [];
 


document.getElementById('cardImage').src = "./Alphabet/"+letter+".png";

function loadGame(){
	buttonSound.play();
	document.getElementById('card').style.display = "none";
	document.getElementById('game').style.display = "flex";
	document.getElementById('instruction').innerHTML = result[0].letter+" से...";
	speakOut("Pick the matching word!");
	loadOptions();

}

function loadOptions(){
	options = [];
	var place = getRandomInt(0,3);
	console.log(place);
	options[place]=result[0];
	var n = 0;
	while (n<3){
		var c = getRandomInt(0,all);
		console.log(someData[c].sound);
		if(n == place)
			n++;
		if (someData[c].key != result[0].key && someData[c].english != ''){
			options[n]=someData[c];
			n++;
		}
	}
	console.log(options);
	for (var i = 0; i < options.length; i++) {
		if(options[i].variant == '')
		document.getElementById('gameImage'+i).src="./Pictures/"+options[i].key+".png";
		else
		document.getElementById('gameImage'+i).src="./Pictures/"+options[i].key+" "+options[i].variant+".png";
	}
}

function getRandomInt(min, max) {
  min = Math.ceil(min);
  max = Math.floor(max);
  return Math.floor(Math.random() * (max - min) + min); // The maximum is exclusive and the minimum is inclusive
}

function checkAnswer(answer){
	if(options[answer].key == letter){
	scoreSound.play();
	speakOut(options[answer].letter+" से "+options[answer].marathi);
	document.getElementById('game').style.display = "none";
	document.getElementById('answer').style.display = "flex";
	document.getElementById('answerImage').src="./Pictures/"+options[answer].key+".png";
	document.getElementById('answerWord').innerHTML=options[answer].marathi;
}
else{
	speakOut(options[answer].letter+" से "+options[answer].marathi+"। नहीं। फिर से कोशिश करें");
}

}


function resetGame(){
	buttonSound.play();
	document.getElementById('card').style.display = "flex";
	document.getElementById('answer').style.display = "none";

}


 function sound(src) {
  this.sound = document.createElement("audio");
  this.sound.src = src;
  this.sound.setAttribute("preload", "auto");
  this.sound.setAttribute("controls", "none");
  this.sound.style.display = "none";
  document.body.appendChild(this.sound);
  this.play = function(){
    this.sound.play();
  }
  this.stop = function(){
    this.sound.pause();
  }
}



async function speakOut (speak){ 
	if(synth.speaking) { 
        console.log('Already speaking....'); 
        if(speak=speakText.text)
        return; 
    }
    if(speak !== '') { 
    	speakText = new SpeechSynthesisUtterance(speak);
    	speakText.lang = 'hi-IN';
    	speakText.rate=0.8;
    	synth.speak(speakText); 
	}
}


</script>
</html>